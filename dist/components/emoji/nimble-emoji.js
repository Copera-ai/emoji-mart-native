'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _extends2=require('../../polyfills/extends');var _extends3=_interopRequireDefault(_extends2);var _objectGetPrototypeOf=require('../../polyfills/objectGetPrototypeOf');var _objectGetPrototypeOf2=_interopRequireDefault(_objectGetPrototypeOf);var _classCallCheck2=require('babel-runtime/helpers/classCallCheck');var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require('../../polyfills/createClass');var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=require('../../polyfills/possibleConstructorReturn');var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=require('../../polyfills/inherits');var _inherits3=_interopRequireDefault(_inherits2);var _react=require('react');var _react2=_interopRequireDefault(_react);var _propTypes=require('prop-types');var _propTypes2=_interopRequireDefault(_propTypes);var _reactNative=require('react-native');var _utils=require('../../utils');var _data=require('../../utils/data');var _sharedProps=require('../../utils/shared-props');function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}var styles=_reactNative.StyleSheet.create({emojiWrapper:{overflow:'hidden'},labelStyle:{textAlign:'center',color:'#ae65c5'}});var NimbleEmoji=function(_React$PureComponent){(0,_inherits3.default)(NimbleEmoji,_React$PureComponent);function NimbleEmoji(props){(0,_classCallCheck3.default)(this,NimbleEmoji);var _this=(0,_possibleConstructorReturn3.default)(this,(NimbleEmoji.__proto__||(0,_objectGetPrototypeOf2.default)(NimbleEmoji)).call(this,props));_initialiseProps.call(_this);_this.customEmojis=[];if(props.custom.length>0){_this.customEmojis=props.custom.map(function(emoji){return(0,_extends3.default)({},emoji,{id:emoji.short_names[0],custom:true});});}return _this;}(0,_createClass3.default)(NimbleEmoji,[{key:'render',value:function render(){if(this.props.data.compressed){(0,_data.uncompress)(this.props.data);}for(var k in NimbleEmoji.defaultProps){if(this.props[k]===undefined&&NimbleEmoji.defaultProps[k]!=undefined){this.props[k]=NimbleEmoji.defaultProps[k];}}var data=this._getData(this.props);if(!data){if(this.props.fallback){return this.props.fallback(null,this.props);}else{return null;}}var unified=data.unified;var custom=data.custom;var short_names=data.short_names;var style={};var imageStyle={};var labelStyle={};var children=this.props.children;var title=null;var emojiImage=void 0;if(!unified&&!custom){if(this.props.fallback){return this.props.fallback(data,this.props);}else{return null;}}if(this.props.tooltip){title=short_names[0];}if(this.props.native&&unified){var fontSize=this.props.size;labelStyle={fontSize:fontSize};children=(0,_utils.unifiedToNative)(unified);style.width=this.props.size+this.props.margin;style.height=this.props.size+this.props.margin;}else if(custom){style={width:this.props.size,height:this.props.size,margin:this.props.noMargin?0:this.props.margin/2};imageStyle={width:this.props.size,height:this.props.size};var emojiImageFile=this._getCustomImage(data);emojiImage=_react2.default.createElement(_reactNative.Image,{style:imageStyle,source:this.props.emojiImageFn(emojiImageFile)});}else{var setHasEmoji=data['has_img_'+this.props.set]==undefined||data['has_img_'+this.props.set];if(!setHasEmoji){if(this.props.fallback){return this.props.fallback(data,this.props);}else{return null;}}style={width:this.props.size,height:this.props.size,margin:this.props.noMargin?0:this.props.margin/2};var _emojiImageFile=this._getImage(data);imageStyle={width:this.props.size,height:this.props.size};emojiImage=_react2.default.createElement(_reactNative.Image,{style:imageStyle,source:this.props.emojiImageFn(_emojiImageFile)});}var emojiComponent=_react2.default.createElement(_reactNative.View,{style:[styles.emojiWrapper,style]},emojiImage||_react2.default.createElement(_reactNative.Text,{style:[styles.labelStyle,labelStyle]},children));return this.props.onPress||this.props.onLongPress?_react2.default.createElement(_reactNative.TouchableWithoutFeedback,{onPress:this._handlePress,onLongPress:this._handleLongPress},emojiComponent):emojiComponent;}}]);return NimbleEmoji;}(_react2.default.PureComponent);NimbleEmoji.defaultProps=_sharedProps.EmojiDefaultProps;var _initialiseProps=function _initialiseProps(){var _this2=this;this._getImage=function(data){var image=data.image;var _props=_this2.props;var set=_props.set;var useLocalImages=_props.useLocalImages;var emoji=_this2._getSanitizedData(_this2.props);var imageSource={uri:'https://unpkg.com/emoji-datasource-'+set+'@'+'4.1.0'+'/img/'+set+'/64/'+image};if(useLocalImages&&useLocalImages[emoji.id]){return useLocalImages[emoji.id].localImages[set][(emoji.skin||NimbleEmoji.defaultProps.skin)-1];}return imageSource;};this._getCustomImage=function(data){var imageUrl=data.imageUrl;var localImage=data.localImage;var useLocalImages=_this2.props.useLocalImages;var emoji=_this2._getSanitizedData(_this2.props);var imageSource={uri:imageUrl};if(useLocalImages&&localImage){return localImage;}return imageSource;};this._getCustomEmoji=function(props){var emoji=props.emoji;var customEmoji=_this2.customEmojis.filter(function(e){return e.id===emoji;})[0];if(customEmoji){return customEmoji;}return emoji;};this._getData=function(props){var skin=props.skin;var set=props.set;var data=props.data;var emoji=props.emoji;if(typeof emoji==='string'){emoji=_this2._getCustomEmoji(props);}return(0,_utils.getData)(emoji,skin,set,data);};this._getSanitizedData=function(props){var emoji=props.emoji;var skin=props.skin;var set=props.set;var data=props.data;return(0,_utils.getSanitizedData)(emoji,skin,set,data);};this._handlePress=function(e){var onPress=_this2.props.onPress;if(!onPress){return;}var emoji=_this2._getSanitizedData(_this2.props);onPress(emoji,e);};this._handleLongPress=function(e){var onLongPress=_this2.props.onLongPress;if(!onLongPress){return;}var emoji=_this2._getSanitizedData(_this2.props);onLongPress(emoji,e);};};exports.default=NimbleEmoji;